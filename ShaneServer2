Windows Server 2:

Configuration
1. # Set DNS to Server 1
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses "192.168.1.100"

2. # Set Static IP, and Gateway to Host Adapter IP
New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress 192.168.1.101 -PrefixLength "24" -DefaultGateway 192.168.1.10

3. # Verify Adapter Interface IDs
Get-NetIPInterface

4. # Set a high priority metric for internal NIC - The lower the metric means higher priority - primary traffic goes over internal network
Set-NetIPInterface -InterfaceIndex “<ifIndex#>” -InterfaceMetric “1”

5. # Set a low priority metric for external NIC - The higher the metric means lower priority - traffic that can't be resolved goes out to 8.8.8.8 on external adapter
Set-NetIPInterface -InterfaceIndex “<ifIndex#>” -InterfaceMetric “2”

6. # Disable firewall
Set-NetFirewallProfile -Enabled False

7. # Disable IPv6
Disable-NetAdapterBinding -Name "Ethernet" -ComponentID ms_tcpip6

8. # Setting Hostname
Rename-Computer -NewName "ShaneServer2"
Restart-Computer

9. # Update PowerShell Help
Update-Help

10. # Install ADDS and Management tools
Install-WindowsFeature -name AD-Domain-Services -IncludeManagementTools

11. # Join Server 2 to Domain
Install-ADDSDomainController -DomainName "shane.local" -Credential (Get-Credential "Shane\Administrator")

12. # Install PowerShell Version 7
Invoke-Expression "& { $(Invoke-RestMethod 'https://aka.ms/install-powershell.ps1') } -useMSI -Quiet -EnablePSRemoting"

13. # Install NuGet Package manager, prerequisite for installing modules
Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force

$Modules = @( 
"Az", 
"AzureAD", 
"MicrosoftTeams", 
"ExchangeOnlineManagement", 
"Microsoft.Online.SharePoint.PowerShell", 
"SharePointPnPPowerShellOnline", 
"Microsoft.Graph", 
"MSOnline" 
)

14. # Installing Modules
Install-Module -Name $Modules -Force

15. # Disable IE Enhanced Security 
function Disable-InternetExplorerESC {
      $AdminKey = "HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}"
      $UserKey = "HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A8-37EF-4b3f-8CFC-4F3A74704073}"
      Set-ItemProperty -Path $AdminKey -Name "IsInstalled" -Value 0 -Force
      Set-ItemProperty -Path $UserKey -Name "IsInstalled" -Value 0 -Force
      Rundll32 iesetup.dll, IEHardenLMSettings
      Rundll32 iesetup.dll, IEHardenUser
      Rundll32 iesetup.dll, IEHardenAdmin
      Write-Host "IE Enhanced Security Configuration (ESC) has been disabled."
 }
Disable-InternetExplorerEsc

16. # Setting Time Zone
Set-TimeZone -Name "Eastern Standard Time"

17. # Configuring and Mapping Network share
Set-Location C:\
New-Item -Type Directory -Name ShaneShare
New-SmbShare -Path C:\ShaneShare -Name "ShaneShare"

# Creating a PS Session variable
$session = New-PSSession -ComputerName "shaneclient" -Credential(Get-Credential)

# Creating a mapping of shared drive on Shaneclient to move files between server and client
Invoke-command -Session $session -ScriptBlock {New-PSDrive -Name "S" -PSProvider "FileSystem" -Root "\\ShaneServer3\Shaneshare"}
